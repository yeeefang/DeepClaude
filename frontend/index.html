<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepClaude 模型設定管理</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body class="animate-fade-in">
    <!-- 授權頁面 -->
    <div id="auth-page" class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card auth-card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="bi bi-shield-lock me-2"></i>DeepClaude 模型設定管理 - 授權</h4>
                    </div>
                    <div class="card-body">
                        <form id="auth-form">
                            <div class="mb-3">
                                <label for="api-key" class="form-label">API Key</label>
                                <input type="password" class="form-control" id="api-key" placeholder="請輸入您的 API Key">
                                <div class="form-text">預設 API Key 為 123456，遠端部署請在登入後於「系統設定」內儘快修改</div>
                            </div>
                            <div id="auth-error" class="alert alert-danger d-none" role="alert">
                                API Key 無效，請重新輸入
                            </div>
                            <button type="submit" class="btn btn-primary w-100"><i class="bi bi-key me-2"></i>驗證</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 設定頁面 -->
    <div id="config-page" class="container-fluid mt-3 d-none">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
            <div class="container-fluid">
                <a class="navbar-brand" href="#"><i class="bi bi-cpu me-2"></i>DeepClaude 模型設定管理</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#composite-models" data-bs-toggle="tab"><i class="bi bi-diagram-3 me-1"></i> 組合模型</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#reasoner-models" data-bs-toggle="tab"><i class="bi bi-braces me-1"></i> 推理模型</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#target-models" data-bs-toggle="tab"><i class="bi bi-bullseye me-1"></i> 目標模型</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#proxy-settings" data-bs-toggle="tab"><i class="bi bi-globe me-1"></i> 代理設定</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#system-settings" data-bs-toggle="tab"><i class="bi bi-gear me-1"></i> 系統設定</a>
                        </li>
                    </ul>
                    <div class="d-flex">
                        <button id="export-config-btn" class="btn btn-outline-light me-2"><i class="bi bi-download me-1"></i> 匯出設定</button>
                        <button id="import-config-btn" class="btn btn-outline-light me-2"><i class="bi bi-upload me-1"></i> 匯入設定</button>
                        <button id="save-all-btn" class="btn btn-success me-2"><i class="bi bi-save me-1"></i> 儲存所有設定</button>
                        <button id="logout-btn" class="btn btn-outline-light"><i class="bi bi-box-arrow-right me-1"></i> 登出</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="tab-content mt-3">
            <!-- 組合模型設定 -->
            <div class="tab-pane fade show active" id="composite-models">
                <div class="container">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="fs-4">組合模型設定</h2>
                        <button id="add-composite-model-btn" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> 新增組合模型
                        </button>
                    </div>
                    <p class="text-muted mb-3">組合模型可以將推理模型與目標模型結合使用，發揮各自優勢。</p>
                    <div id="composite-models-container" class="row"></div>
                </div>
            </div>

            <!-- 推理模型設定 -->
            <div class="tab-pane fade" id="reasoner-models">
                <div class="container">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="fs-4">推理模型設定</h2>
                        <button id="add-reasoner-model-btn" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> 新增推理模型
                        </button>
                    </div>
                    <p class="text-muted mb-3">推理模型負責處理複雜的邏輯推理任務，如 DeepSeek R1 等模型。</p>
                    <div id="reasoner-models-container" class="row"></div>
                </div>
            </div>

            <!-- 目標模型設定 -->
            <div class="tab-pane fade" id="target-models">
                <div class="container">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="fs-4">目標模型設定</h2>
                        <button id="add-target-model-btn" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> 新增目標模型
                        </button>
                    </div>
                    <p class="text-muted mb-3">目標模型是最終輸出結果的模型，如 Claude Sonnet 4 或 Gemini 2.5 Pro 等。</p>
                    <div id="target-models-container" class="row"></div>
                </div>
            </div>

            <!-- 代理設定 -->
            <div class="tab-pane fade" id="proxy-settings">
                <div class="container">
                    <h2 class="fs-4">代理設定</h2>
                    <p class="text-muted mb-3">如果您需要存取國際模型 API，可能需要設定代理。</p>
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0 fs-5"><i class="bi bi-globe me-1"></i> 代理設定</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3">
                                <i class="bi bi-info-circle me-1"></i> 正確的代理設定可以幫助您更穩定地存取國際模型 API
                            </div>
                            <form id="proxy-form">
                                <div class="mb-3 form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="proxy-open">
                                    <label class="form-check-label" for="proxy-open">啟用代理</label>
                                    <div class="form-text mt-1">開啟後，所有模型請求將透過此代理傳送</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">代理位址</label>
                                    <input type="text" class="form-control" id="proxy-address" placeholder="例如: 127.0.0.1:7890">
                                    <div class="form-text">通常為本機代理位址和連接埠，如 127.0.0.1:7890</div>
                                </div>
                                <button type="button" class="btn btn-primary" id="save-proxy-btn">儲存代理設定</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 系統設定 -->
            <div class="tab-pane fade" id="system-settings">
                <div class="container">
                    <h2 class="fs-4">系統設定</h2>
                    <p class="text-muted mb-3">設定系統層級的選項，包括 API 存取權限和記錄等級等。</p>
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0 fs-5"><i class="bi bi-gear me-1"></i> 系統設定</h5>
                        </div>
                        <div class="card-body">
                            <form id="system-form">
                                <div class="mb-3">
                                    <label class="form-label">允許的來源 (CORS)</label>
                                    <div class="form-text mb-2">設定允許存取 API 的網域，使用 * 表示允許所有網域存取</div>
                                    <div id="allow-origins-container">
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control allow-origin" placeholder="例如: * 或 http://localhost:3000">
                                            <button class="btn btn-outline-secondary remove-origin-btn" type="button">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add-origin-btn">
                                        <i class="bi bi-plus"></i> 新增來源
                                    </button>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">記錄等級</label>
                                    <div class="form-text mb-2">設定系統記錄的詳細程度</div>
                                    <select class="form-select" id="log-level">
                                        <option value="DEBUG">DEBUG - 詳細除錯資訊</option>
                                        <option value="INFO">INFO - 一般資訊</option>
                                        <option value="WARNING">WARNING - 警告資訊</option>
                                        <option value="ERROR">ERROR - 錯誤資訊</option>
                                        <option value="CRITICAL">CRITICAL - 嚴重錯誤</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">API Key</label>
                                    <input type="text" class="form-control" id="system-api-key" placeholder="設定 API Key">
                                    <div class="form-text mt-2">預設值為 123456，在聊天軟體內使用時填寫此 API Key。如部署在雲端請儘快修改。</div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="save-deepseek-tokens">
                                        <label class="form-check-label" for="save-deepseek-tokens">節省 DeepSeek Tokens</label>
                                    </div>
                                    <div class="form-text">開啟後將在使用原生推理模型時大幅節省輸出 tokens。</div>
                                </div>
                                <div class="mb-3" id="deepseek-tokens-max-container">
                                    <label class="form-label">DeepSeek Tokens 最大限制</label>
                                    <input type="number" class="form-control" id="deepseek-tokens-max" min="1" max="1000" placeholder="5">
                                    <div class="form-text">設定 DeepSeek R1 輸出 tokens 最大數量，建議 5。</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">推理內容最大 Tokens（傳給目標模型）</label>
                                    <input type="number" class="form-control" id="max-reasoning-tokens" min="0" max="100000" placeholder="0">
                                    <div class="form-text">設定傳給目標模型的推理內容最大 token 數。0 表示不限制。降低此值可減少目標模型輸入成本。建議 4000-8000。</div>
                                </div>
                                <button type="button" class="btn btn-primary" id="save-system-btn">儲存系統設定</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 範本 -->
    <template id="reasoner-model-template">
        <div class="col-md-6 mb-4 reasoner-model-card">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 model-name"></h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary edit-model-btn"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger delete-model-btn"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <form class="model-form">
                        <div class="mb-3">
                            <label class="form-label">模型 ID</label>
                            <input type="text" class="form-control model-id" placeholder="模型 ID">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">API Key</label>
                            <input type="password" class="form-control api-key" placeholder="API Key">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Base URL</label>
                            <input type="text" class="form-control api-base-url" placeholder="例如: https://api.example.com">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">API 請求位址</label>
                            <input type="text" class="form-control api-request-address" placeholder="例如: v1/chat/completions">
                        </div>
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input is-origin-reasoning" type="checkbox">
                            <label class="form-check-label">是否原生支援推理</label>
                        </div>
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input is-valid" type="checkbox">
                            <label class="form-check-label">模型可用</label>
                        </div>
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input is-proxy-open" type="checkbox">
                            <label class="form-check-label">是否開啟代理</label>
                        </div>
                        <button type="button" class="btn btn-primary save-model-btn">儲存</button>
                    </form>
                </div>
            </div>
        </div>
    </template>

    <template id="target-model-template">
        <div class="col-md-6 mb-4 target-model-card">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 model-name"></h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary edit-model-btn"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger delete-model-btn"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <form class="model-form">
                        <div class="mb-3">
                            <label class="form-label">模型 ID</label>
                            <input type="text" class="form-control model-id" placeholder="模型 ID">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">API Key</label>
                            <input type="password" class="form-control api-key" placeholder="API Key">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Base URL</label>
                            <input type="text" class="form-control api-base-url" placeholder="例如: https://api.example.com">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">API 請求位址</label>
                            <input type="text" class="form-control api-request-address" placeholder="例如: v1/chat/completions">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">模型格式</label>
                            <select class="form-select model-format">
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                            </select>
                        </div>
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input is-valid" type="checkbox">
                            <label class="form-check-label">模型可用</label>
                        </div>
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input is-proxy-open" type="checkbox">
                            <label class="form-check-label">是否開啟代理</label>
                        </div>
                        <button type="button" class="btn btn-primary save-model-btn">儲存</button>
                    </form>
                </div>
            </div>
        </div>
    </template>

    <template id="composite-model-template">
        <div class="col-md-6 mb-4 composite-model-card">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 model-name"></h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary edit-model-btn"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger delete-model-btn"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <form class="model-form">
                        <div class="mb-3">
                            <label class="form-label">模型 ID</label>
                            <input type="text" class="form-control model-id" placeholder="模型 ID">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">推理模型</label>
                            <select class="form-select reasoner-model-select"></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">目標模型</label>
                            <select class="form-select target-model-select"></select>
                        </div>
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input is-valid" type="checkbox">
                            <label class="form-check-label">模型可用</label>
                        </div>
                        <button type="button" class="btn btn-primary save-model-btn">儲存</button>
                    </form>
                </div>
            </div>
        </div>
    </template>

    <!-- 新增模型對話框 -->
    <div class="modal fade" id="add-model-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="add-model-title">新增模型</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="add-model-form">
                        <div class="mb-3">
                            <label for="new-model-name" class="form-label">模型名稱</label>
                            <input type="text" class="form-control" id="new-model-name" placeholder="例如: Provider/Model-Name">
                        </div>
                        <div id="add-model-fields"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirm-add-model">新增</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 確認刪除對話框 -->
    <div class="modal fade" id="confirm-delete-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">確認刪除</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    確定要刪除 <span id="delete-model-name"></span> 嗎？此操作無法復原。
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn">刪除</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 匯入設定對話框 -->
    <div class="modal fade" id="import-config-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-upload me-2"></i>匯入設定檔</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        請選擇之前匯出的設定檔（JSON 格式）。匯入後將覆蓋目前所有設定。
                    </div>
                    <div class="mb-3">
                        <label for="config-file-input" class="form-label">選擇設定檔</label>
                        <input type="file" class="form-control" id="config-file-input" accept=".json" />
                        <div class="form-text">支援 .json 格式的設定檔</div>
                    </div>
                    <div id="config-preview" class="d-none">
                        <label class="form-label">設定預覽</label>
                        <div class="card bg-light">
                            <div class="card-body">
                                <div id="config-preview-content" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirm-import-btn" disabled>
                        <i class="bi bi-upload me-1"></i>匯入設定
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 提示框 -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toast-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./static/js/auth.js"></script>
    <script src="./static/js/config.js"></script>
    <script src="./static/js/main.js"></script>

    <style>
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .auth-card { animation: slideDown 0.5s ease-out; }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>

    <footer class="bg-light text-center text-lg-start mt-5">
        <div class="container p-4">
            <div class="row">
                <div class="col-lg-6 col-md-12 mb-4 mb-md-0">
                    <h5>DeepClaude 開源專案</h5>
                    <p>DeepClaude 是一個強大的組合模型使用方案，藉助 DeepSeek R1 等推理模型來提升 Claude 或 Gemini 等模型的能力。</p>
                </div>
                <div class="col-lg-6 col-md-12 mb-4 mb-md-0">
                    <h5 class="text-uppercase">相關連結</h5>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <a href="https://github.com/yeeefang/DeepClaude" class="text-primary text-decoration-none">
                                <i class="bi bi-github me-1"></i> GitHub 專案
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.05);">
            2025 版權所有：<a class="text-dark text-decoration-none" href="#">DeepClaude</a>
        </div>
    </footer>
</body>
</html>
